machine:
  timezone:
    Asia/Tokyo
dependencies:
  pre:
    - curl -o $HOME/go_appengine_1.9.40.zip https://storage.googleapis.com/appengine-sdks/featured/go_appengine_sdk_linux_amd64-1.9.40.zip
    - unzip -q -d $HOME $HOME/go_appengine_1.9.40.zip
  override:
    - $HOME/go_appengine/goapp get -t -d -v  ./app/...
test:
  override:
    - $HOME/go_appengine/goapp test -v ./app/
deployment:
  appengine:
    branch: master
    commands:
      - openssl aes-256-cbc -d -in app/secret-cipher -k $SECRET_KEY > test.json
      - $HOME/go_appengine/appcfg.py update . --oauth2_access_token $(tools/gtoken --json test.json)
